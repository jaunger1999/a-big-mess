#define DISARMED 0

thingtype Cyberbaron
{
  doomednum 30006
  basictype Monster

  spawnhealth  800
  speed        10
  radius       24.0
  height       64.0
  damage       12
  reactiontime 8
  painchance   40
  mass         1000

  addflags NORADIUSDMG|HIGHERMPROB
  
  bloodtype.normal PersistentDoomBlood
  bloodtype.impact PersistentDoomBlood
  bloodtype.rip PersistentDoomBlood  
  bloodtype.crush DoomBloodSpray

  seesound    "cyberbaron/sight"
  painsound   "cyberbaron/pain"
  deathsound  "cyberbaron/death"
  activesound "cyberbaron/active"
  attacksound "cyberbaron/attack"

  obituary_normal "rode a cyberbaron's rocket"
  obituary_melee  "got clawed by a cyberbaron"

  acs_spawndata
  {
    num 246
    modes doom
  }

  states
  @"    
  Spawn:
    TNT1 A 0 A_SetCounter(DISARMED, FALSE)
  SpawnLoop:
	CBAR AB 10 A_Look
    Loop
  Inactive:
    TNT1 A 1 A_UnsetFlags(0, SHOOTABLE)
    Loop
  Active:
    TNT1 A 0 A_HealthJump(AlreadyDead, lessorequal, 0)
    TNT1 A 0 A_SetFlags(0, SHOOTABLE)
    Goto Spawn
  See:
	TNT1 A 0 A_CounterJump(SeeDisarmed, equal, TRUE, DISARMED)
	SeeDisarmed:
    CBAR AA 3 A_Chase()
    TNT1 A 0 A_PlaySoundEx("cyberbaron/step", 5)
    CBAR BB 3 A_Chase()
    CBAR CC 3 A_Chase()
    TNT1 A 0 A_PlaySoundEx("cyberbaron/step", 5)
    CBAR DD 3 A_Chase()
    Loop
  Missile:
    CBAR E 12 A_FaceTarget()
    CBAR F 12 Bright A_MissileAttack(BruiserRocket)
    CBAR E 12 A_FaceTarget()
    CBAR F 12 Bright A_MissileAttack(BruiserRocket)
    CBAR E 12 A_FaceTarget()
    CBAR F 12 Bright A_MissileAttack(BruiserRocket)
    Goto See
  Melee:
    CBAR PQ 7 A_FaceTarget()
    CBAR  R 7 A_Scratch(1, 0, "cyberbaron/attack")
    Goto See
  Pain:
    TNT1 A 0 A_CounterJump(PainDisarmed, equal, TRUE, DISARMED)
   	TNT1 A 0 A_HealthJump(400, lessorequal, PainBecomeDisarmed)
    CBAR H 2
    CBAR H 2 A_Pain()
    Goto See
  PainBecomeDisarmed:
    CBAD HHHHHHH 8 //TNT1 A 0 A_SteamSpawn(BloodSpray, 359, 90, 45, 18)
  Death:
    CBRU K 6 Bright A_Scream()
    CBRU LM 6 Bright
    CBRU N 6 Bright A_Fall()
    CBRU O 6 Bright
    CBRU PQR 6 Bright
  RestingDeath:
    CBRU S -1
    Stop
  AlreadyDead:
    TNT1 A 0 A_Fall()
    goto RestingDeath
  "@
}

thingtype BruiserRocket
{
  basictype Projectile

  radius 8.0
  height 12.0
  speed  20.0
  damage 10

  seesound   "cyberbaron/missile/fire"
  deathsound "cyberbaron/missile/explode"

  states
  @"
  Spawn:
    FBRS A 2 Bright A_SteamSpawn(OGTracerSmoke)
    Loop
  Death:
    BAL3 C 6 Bright A_DetonateEx(24, 48, 0)
    BAL3 DE 6 Bright
    Stop
  "@
}

sound "cyberbaron/step"            { lump "DSBRUSTP"; pitchvariance Doom; }
sound "cyberbaron/sight"           { lump "DSBRUSIT"; pitchvariance Doom; }
sound "cyberbaron/death"           { lump "DSBRUDTH"; pitchvariance Doom; }
sound "cyberbaron/pain"            { lump "DSDMPAIN"; pitchvariance Doom; }
sound "cyberbaron/active"          { lump "DSDMACT" ; pitchvariance Doom; }
sound "cyberbaron/attack"          { lump "DSCLAW"  ; pitchvariance Doom; }
sound "cyberbaron/missile/fire"    { lump "DSBRUFIR"; pitchvariance Doom; }
sound "cyberbaron/missile/explode" { lump "DSHELLEX"; pitchvariance Doom; }